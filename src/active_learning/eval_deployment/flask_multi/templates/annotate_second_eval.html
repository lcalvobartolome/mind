<!DOCTYPE html>
<html>
  <head>
    <title>Annotate Document</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .my_radio {
        margin-left: 20px;
      }
      .center-button,
      .center-buttons {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }
      .disabled-button {
        pointer-events: none;
        opacity: 0.6;
      }
      .question-container {
        padding-left: 20px; /* Adjust the value as needed */
      }
      
      .highlight_health {
        background-color: #9b9a34;
        color: black;
        font-weight: bold;
      }
      .definition_health {
          color: #9b9a34;
      }
      .highlight_kids {
          background-color: #329999;
          color: black;
          font-weight: bold;
      }
      .definition_kids {
          color: #329999;
      }
      .highlight_women {
          background-color: #329933;
          color: black;
          font-weight: bold;
      }
      .definition_women {
          color: #329933;
      }
      .highlight_ss {
          background-color: #fe32fc;
          color: black;
          font-weight: bold;
      }
      .definition_ss {
          color: #fe32fc;
      }
      .highlight_none {
          background-color: #808080;
          color: black;
          font-weight: bold;
      }
      .definition_none {
          color: #808080;
      }
    table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
      }
      th, td {
          padding: 10px;
          text-align: center;
          vertical-align: middle;
      }
      .table-striped tbody tr:nth-of-type(odd) {
          background-color: rgba(0, 0, 0, 0.05);
      }
      .table-bordered th, .table-bordered td {
          border: 1px solid #dee2e6;
      }
      .checkbox-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 10px;
      }
      .checkbox-group label {
          margin-bottom: 5px;
      }
      .checkbox-group div {
          display: flex;
          align-items: center;
          gap: 10px;
      }
      .thead-custom {
          background-color: #024287ee;
          color: white;
      }
      .alert-heading {
          margin-top: 20px;
      }
      input[type="radio"] {
          appearance: none;
          background-color: #fff;
          border: 1px solid #ccc;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          position: relative;
          cursor: pointer;
          outline: none;
      }
      input[type="radio"]:checked {
          background-color: #555;
          border-color: #555;
      }
      input[type="radio"]::before {
          content: '';
          display: block;
          width: 60%;
          height: 60%;
          border-radius: 50%;
          background-color: #fff;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }
      input[type="radio"]:checked::before {
          background-color: #555;
      }

      .thead-custom {
        background-color: #024287ee; /* Bluish background color */
        color: white;
      }
      .instructions {
        display: none;
        margin-top: 20px; /* Adjust the value as needed */
      }
      .message {
        font-size: 24px; /* Tama√±o de fuente m√°s grande */
        font-weight: bold; /* Negrita */
        text-align: center; /* Centrado */
        margin-top: 20px; /* Espacio superior */
      }
      .text-danger {
          color: red; /* Color rojo para los errores */
      }
      .text-success {
          color: green; /* Color verde para el √©xito */
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        // Function to fetch document count
        function fetchDocumentCount() {
          $.get("/get_document_count", function (data) {
            if (
              data.total_documents !== undefined &&
              data.remaining_documents !== undefined
            ) {
              $("#document_count").text(
                "Documents Left: " +
                  data.remaining_documents +
                  "/" +
                  data.total_documents
              );
            } else {
              $("#document_count")
                .text("Error fetching document count")
                .addClass("text-danger");
            }
          });
        }

        // Function to fetch a new document
        function fetchDocument() {
          $.post("/get_new_document", function (data) {
            console.log(data);
            if (data.error) {
              $("#message").text(data.error).addClass("text-danger");
              $("#annotation_form").hide();
            } else if (data.message) {
              $("#message").text(data.message).addClass("text-success");
              $("#main_content").hide();
              $("#document_count").hide();
              $("#completion_message").show();
            } else {
              $("#document").text(data.text);
              $("#document_full_text").text(data.full_doc);
              console.log("this is the doc_id");
              console.log(data.doc_id);
              $("#doc_id").val(data.doc_id);
              const aux_idx = $("#doc_id").val();
              console.log("this is the idx");
              console.log(aux_idx);
              $("#message").text("");
              $("#annotation_form").show();

              // Clear all radio button selections
              $('#annotation_form input[type="radio"]').prop('checked', false);

              fetchDocumentCount(); // Update the document count after fetching a new document
            }
          });
        }

        // Function to submit annotation
        function submitAnnotation(label) {
          const idx = $("#doc_id").val();
          console.log("this is the idx");
          console.log(idx);
          $.post(
            "/submit_annotation",
            { label: label, idx: idx },
            function (response) {
              if (response.message) {
                $("#message")
                  .text(response.message)
                  .removeClass("text-danger")
                  .addClass("text-success");
                fetchDocument(); // Fetch a new document after successful annotation
              } else {
                $("#message")
                  .text(response.error)
                  .removeClass("text-success")
                  .addClass("text-danger");
              }
            }
          );
        }

        // Event listener for the annotate button
        document
          .getElementById("annotate_button")
          .addEventListener("click", function () {
            const annotations = [];
            let allSelected = true; // Variable to track if all options are selected

            // Function to check and push the value for each category
            function checkAndPush(name) {
              const selected = document.querySelector(
                `input[name="${name}"]:checked`
              );
              if (selected) {
                annotations.push(selected.value === "yes" ? 1 : 0);
              } else {
                allSelected = false; // Mark as false if any option is not selected
              }
            }

            // Check each category
            checkAndPush("health");
            checkAndPush("kids");
            checkAndPush("women");
            checkAndPush("services");

            // Show message and prevent submission if not all options are selected
            if (!allSelected) {
              alert("Please select an option for all categories.");
              return; // Prevent further execution
            }

            if (annotations.length === 0) {
              annotations.push(0); // None
            }
            // Convert annotations array to a string
            const annotationsString = annotations.join(',');

            console.log(annotationsString);
            submitAnnotation(annotationsString);
          });

        $("#show_instructions").on("click", function () {
          $(".instructions").toggle();
        });

        fetchDocument(); // Fetch the first document when the page loads
      });
    </script>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Annotate Passage</h1>
      <div class="center-buttons">
        <button id="show_instructions" class="btn btn-secondary mb-3">
          Show Instructions
        </button>
      </div>
      <div class="alert alert-secondary" id="document_count">Loading document count...</div>
      <div id="main_content">
        <b> Passage </b>
        <div class="card mb-3">
          <div class="card-body">
            <p id="document">Loading...</p>
            <input type="hidden" id="doc_id" value="">
          </div>
        </div>
        <b> Context (full text)  </b>
        <div class="card mb-3">
          <div class="card-body" style="height: 200px; overflow-y: auto;">
            <p id="document_full_text">Loading...</p>
          </div>
        </div>

        <div class="question-container" id="annotation_form" class="annotation-buttons mb-3">
          <div class="annotation-buttons mt-2">
            <label>Is this passage relevant for <b><span class="highlight_health">HEALTH</span></b> given the context in which it appears? ü©∫</label>
            <div>
              <input class="my_radio" type="radio" id="health_yes" name="health" value="yes" />
              <label for="health_yes">YES</label>
              <input class="my_radio" type="radio" id="health_no" name="health" value="no" />
              <label for="health_no">NO</label>
            </div>
          </div>
          <div class="annotation-buttons mt-2">
            <label>Is this passage relevant for <b><span class="highlight_kids">KIDS</span></b> given the context in which it appears? üßí</label>
            <div>
              <input class="my_radio" type="radio" id="kids_yes" name="kids" value="yes" />
              <label for="kids_yes">YES</label>
              <input class="my_radio" type="radio" id="kids_no" name="kids" value="no" />
              <label for="kids_no">NO</label>
            </div>
          </div>
          <div class="annotation-buttons mt-2">
            <label>Is this passage relevant for <b><span class="highlight_women">WOMEN</span></b> given the context in which it appears? üë©</label>
            <div>
              <input class="my_radio" type="radio" id="women_yes" name="women" value="yes" />
              <label for="women_yes">YES</label>
              <input class="my_radio" type="radio" id="women_no" name="women" value="no" />
              <label for="women_no">NO</label>
            </div>
          </div>
          <div class="annotation-buttons mt-2">
            <label>Is this passage relevant for <b><span class="highlight_ss">SOCIAL SERVICES</span></b> given the context in which it appears? üè¢</label>
            <div>
              <input class="my_radio" type="radio" id="services_yes" name="services" value="yes" />
              <label for="services_yes">YES</label>
              <input class="my_radio" type="radio" id="services_no" name="services" value="no" />
              <label for="services_no">NO</label>
            </div>
          </div>
        </div>
  
          <div class="center-button">
            <button class="btn btn-primary btn-lg btn-block" id="annotate_button">
              Annotate
            </button>
          </div>
          <div class="center-button">
            <p id="message" class="message mt-3"></p>
          </div>
        </div>
          <div
            id="time_up_message"
            style="text-align: center; margin-top: 20px; display: none"
          >
            <h2 style="color: green; font-weight: bold">
              Time is up! Your feedback has been collected.
            </h2>
            <h3 style="color: gray">
              Thank you for your participation! &#128522;
            </h3>
          </div>
          <div class="instructions alert alert-info" style="display: none">
            <h1 class="mb-4">Instructions for Evaluating Rosie Corpus Documents</h1>    
          <h4>üìñ Task Orientation</h4>
          <p>
              You will be evaluating passages from the Rosie Corpus. Each passage will be provided along with the full document it belongs to, giving you context. For each passage, your task is to answer the following question:
  
              <em><b>"Is this passage relevant to CATEGORY given the context in which it appears?"</b></em>
              
              <b>To help answer this question, consider whether someone might ask a question or seek information under this category.</b>
              
          </p>
          <p>Please review each category definition and example below to guide your evaluation:</p>
          
          <!-- Box around the categories with adjusted padding and margin -->
          <div style="border: 2px solid #D3D3D3; padding: 10px 15px; border-radius: 8px; margin-top: 0; margin-bottom: 15px;">
          
              <div class="mt-3">
                  <div>
                      <span class="highlight highlight_health">Health</span>
                  </div>
                  <div>
                      <b>Definition:</b> Text related to physical and mental well-being, such as medical care, disease prevention, wellness programs, and healthcare services.
                      <br>If a passage does not contain any medical advice (even if it includes some health-related words), it is not considered health-related.
                  </div>
                  <div>
                      <b>Example:</b> <em>‚ÄúTreatment options for germ cell tumors may include surgery to remove the tumor, chemotherapy with drugs that kill cancer cells, and radiation therapy with powerful energy beams.‚Äù</em>
                  </div>
              </div>
          
              <div class="mt-3">
                  <div>
                      <span class="highlight highlight_kids">Kids</span>
                  </div>
                  <div>
                      <b>Definition:</b> Text focused on issues, programs, or services specifically related to children. This includes topics such as education, child development (e.g., stages of child growth, questions like "Is it normal that my child...?", or "What extra-curricular activities should my child participate in?"), childcare, and pediatric care.
  
                  </div>
                  <div>
                      <b>Example:</b> <em>Astraphobia is the extreme fear of thunder and lightning. It‚Äôs most common in children‚Ä¶</em>
                  </div>
              </div>
          
              <div class="mt-3">
                  <div>
                      <span class="highlight highlight_women">Women</span>
                  </div>
                  <div>
                      <b>Definition:</b> Texts addressing the health, rights, and well-being of women, including reproductive health and gender-specific healthcare.
                  </div>
                  <div>
                      <b>Example:</b> <em>‚ÄúBecause the seroconversion rate after vaccination of pregnant women might be markedly reduced compared with that of other healthy women, serologic tests to determine if a specific yellow fever immune response exists should be considered‚Ä¶‚Äù</em>
                  </div>
              </div>
          
              <!-- Distinct style for the note on mothers and children -->
              <div style="background-color: #FFF2CC; padding: 8px 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #FFB74D;">
                  <p><b>üìå Note:</b> If a passage mentions studies or conditions that apply to pregnant or new mothers, and the context includes both mothers and children, please select both <b>KIDS</b> and <b>WOMEN</b> as relevant categories.</p>
              </div>
          
              <div class="mt-3">
                  <div>
                      <span class="highlight highlight_ss">Social Services</span>
                  </div>
                  <div>
                      <b>Definition:</b> Text that mentions services aimed at improving quality of life and providing assistance to individuals or families. Examples include welfare programs, counseling, housing assistance, and community support services.
                  </div>
                  <div>
                      <b>Example:</b> <em>‚ÄúThe grants, available in fiscal year 2023 and supported and administered by NIOSH, will provide funding to qualified individuals in academia, members of non-profit organizations, municipalities, and businesses involved in the fishing and maritime industries‚Ä¶‚Äù</em>
                  </div>
              </div>
          </div>
          
          <!-- Different styling for the "Important" note -->
          <div style="background-color: #FFF9C4; padding: 8px 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #FFD54F;">
              <p><b>üîç Important:</b> If a passage does not fit any of these categories, consider it <b>non-applicable</b>. This means the passage does not directly relate to any of the specified categories, or it may be loosely related but not truly relevant (e.g., it references unrelated articles, contains very specific statistics, or is purely technical without contextual relevance). In this case, please select <b>NO</b> for each category. Here are some examples of passages that are <b>not relevant</b> for any category:
              </p>
              <ul>
                  <li><em>If your child has a follow-up visit, write down the date, time, and purpose of the visit.</em> (This is just a doctor appointment reminder, not relevant to any specific category.)</li>
                  <li><em>Microbiological images. These may include photos of bacteria, fungi, parasites, or viruses, taken from fresh or stained samples and observed under optical, electron, or fluorescence microscopy...</em> (This is a technical description with no direct relevance to the categories.)</li>
                  <li><em>There is no doctor whose last name begins with the letter Q. Find a doctor whose last name begins with the letter R. Find a doctor whose last name begins with the letter S...</em> (This is a directory listing without context for any category.)</li>
                  <li><em>Since April 2021, the FDA has received more than 109,000 MDRs, including 426 reports of death, reportedly associated with the PE-PUR foam breakdown or suspected foam breakdown.</em> (This is a general report without specific relevance to the categories.)</li>
                  <li><em>Fisher AA, Pascher F, Kanof NB. Allergic contact dermatitis due to ingredients of vehicles. A vehicle tray for patch testing. Arch Dermatol 1971;104:286-90.</em> (This is a bibliographic reference, which is unrelated to any category.)</li>
              </ul>
              <p>
                  However, if you are unsure about whether a passage might be relevant to a certain category, please select it as <span class="highlight highlight_relevant">RELEVANT</span> to avoid potentially missing any applicable content.
              </p>
              <p>
                  You can <strong>toggle the button below</strong> to view some additional <strong>example annotations</strong>.
              </p> 
          </div>
  
          <div class="center-buttons">
              <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#exampleAnnotations" aria-expanded="false" aria-controls="exampleAnnotations">
                  Toggle Example Annotations
              </button>
          </div>
  
          <div id="exampleAnnotations" class="collapse">
              <table class="table table-bordered table-striped">
                  <thead class="thead-custom">
                      <tr>
                          <th>Document</th>
                          <th>HEALTH</th>
                          <th>KIDS</th>
                          <th>WOMEN</th>
                          <th>SOCIAL SERVICES</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td>Despite that, most babies get diaper rash at some point‚Ä¶.</td>
                          <td><input class="my_radio" type="radio" name="doc4_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc4_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Because the seroconversion rate after vaccination of pregnant women might be markedly reduced compared with that of other healthy women, serologic tests to determine if a specific yellow fever immune response exists should be considered‚Ä¶.</td>
                          <td><input class="my_radio" type="radio" name="doc5_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc5_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Mayo Clinic's medical rehabilitation expertise will be integrated with MN BIA Resource Facilitation services to connect individuals with TBI to community resources‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc6_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc6_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Children who were treated with antibiotics also experienced nearly four fewer ‚Äúsick days‚Äù at home on average than those who underwent surgery. Their caregivers required less of this time as well‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc7_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc7_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Watch the Meaningful Renewal team work with family child care providers to provide safe learning environments for different age groups. Create environments that promote children's social and emotional development...</td>
                          <td><input class="my_radio" type="radio" name="doc8_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc8_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Women are the fastest growing group of female military veterans in the United States and have specific health care needs. And women veterans are taking steps to fully address those needs‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc9_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc9_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Continue to foster the learning process by engaging, responding, and encouraging exploration. Practice and build on what your little one learns with age-appropriate toys and a safe environment to explore‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc10_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_women" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc10_services" disabled/></td>
                      </tr>
                      <tr>
                          <td>Each person's journey through postpartum depression (PPD) is specific to each person, but there are many ways to get help. The first step towards healing is to seek support. Listen to Clarissa tell how she found support to help her heal at www.womenshealth.gov/talkingPPD....</td>
                          <td><input class="my_radio" type="radio" name="doc11_health" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_kids" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc11_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>Dual Language Learners: Program and Family Support In this module, explore the four components of effective program and family support for dual language learners‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc12_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_kids" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_women" checked disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_services" checked disabled/></td>
                      </tr>
                      <tr>
                          <td>The technique involves sexually stimulating the man until he recognizes that he is about to ejaculate‚Ä¶‚Ä¶</td>
                          <td><input class="my_radio" type="radio" name="doc12_health" disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_kids"  disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_women"  disabled/></td>
                          <td><input class="my_radio" type="radio" name="doc12_services"  disabled/></td>
                      </tr>
                  </tbody>
              </table>
          </div>
  
          <h4>‚úîÔ∏è Steps to Follow</h4>
          <ol>
              <li>Review the passage and the context in which it appears.</li>
              <li>
                  Provide annotations by checking the corresponding boxes:
                  <div class="annotation-buttons mt-2">
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_health">HEALTH</span></b> given the context in which it appears? ü©∫</label>
                          <div>
                              <input class="my_radio" type="radio" id="health_yes" name="health" disabled value="yes"/>
                              <label for="health_yes">YES</label>
                              <input class="my_radio" type="radio" id="health_no" name="health" disabled value="no"/>
                              <label for="health_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_kids">KIDS</span></b> given the context in which it appears? üßí</label>
                          <div>
                              <input class="my_radio" type="radio" id="kids_yes" name="kids" disabled value="yes"/>
                              <label for="kids_yes">YES</label>
                              <input class="my_radio" type="radio" id="kids_no" name="kids" disabled value="no"/>
                              <label for="kids_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_women">WOMEN</span></b> given the context in which it appears? üë©</label>
                          <div>
                              <input class="my_radio" type="radio" id="women_yes" name="women" disabled value="yes"/>
                              <label for="women_yes">YES</label>
                              <input class="my_radio" type="radio" id="women_no" name="women" disabled value="no"/>
                              <label for="women_no">NO</label>
                          </div>
                      </div>
                      <div class="checkbox-group">
                          <label>Is this passage relevant for <b><span class="highlight_ss">SOCIAL SERVICES</span></b> given the context in which it appears? üè¢</label>
                          <div>
                              <input class="my_radio" type="radio" id="services_yes" name="services" disabled value="yes"/>
                              <label for="services_yes">YES</label>
                              <input class="my_radio" type="radio" id="services_no" name="services" disabled value="no"/>
                              <label for="services_no">NO</label>
                          </div>
                      </div>
                  </div>
              </li>
              <li>Wait for the message <strong style="color:green;">"Document labeled successfully"</strong> before moving to the next document.</li>
              <li>Once the active learning loop is completed, a <strong>completion message</strong> will be displayed in large, <strong style="color:green;">green font</strong>.
              </li>
          </ol>  
          </div>
        </div>
      </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
